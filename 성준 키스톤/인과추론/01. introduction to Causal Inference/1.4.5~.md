---
date: 2025-06-29
완료: false
tags:
---
## 지난시간 요약
>연관관계는 두 변수 사이에 어떤 관련이 있다는 것을 보여주지만, 인과관계는 한 변수가 다른 변수에 직접적인 영향을 준다는 의미를 가집니다. 따라서 연관관계가 있다고 해서 곧바로 인과관계를 추론할 수는 없습니다. 인과 추론(Causal Inference)은 이러한 한계를 극복하고, 실제로 한 변수가 다른 변수에 어떤 영향을 주는지를 과학적으로 밝히려는 시도입니다. 이는 ‘만약 우리가 개입한다면 결과는 어떻게 바뀔까?’라는 질문에 답하기 위한 도구이며, 특히 정책 결정이나 마케팅 전략 등 실질적인 변화와 효과를 예측하는 데 필수적입니다. 머신러닝은 예측에 강하지만, 개입의 효과를 따지는 인과 추론에는 약하기 때문에 서로 다른 목적과 강점을 지닌다는 점도 중요합니다.


## Individual Treatment Effect

### 1. 쉽게 설명하면?

우리는 어떤 처치를 했을 때 개별 사람(또는 개별 단위)에게 어떤 영향을 주었는지 알고 싶다고 생각하자.
예를 들어 마트에서 어떤 상품에 "세일" 딱지를 붙이면, **그 상품이 실제로 얼마나 더 팔리는지** 궁금하겠죠?
이때, 'do 연산자'를 써서 다음처럼 씁니다:

$$\tau_i = Y_i\mid do(T=t_1) - Y_i\mid do(T=t_0)$$

- $Y_i$: $i$번 사람(또는 단위)의 결과 (예: 판매량)
- $T$: 처치 (예: 세일 여부)
- $do(T=t_1)$: 처치를 실제로 했을 때 (예: 세일을 했을 때)
- $do(T=t_0)$: 처치를 하지 않았을 때 (예: 세일을 안 했을 때)

$$\tau_i = AmountSold_i \mid do(IsOnSales = 1) - AmountSold_i \mid do(IsOnSales = 0)$$

즉, **같은 사람이 세일을 했을 때와 안 했을 때 결과의 차이**가 바로 그 사람에게 주는 '**처치의 효과**'

---

### 2. 예시로 보면?

```text
상품 A의 판매량을 보고 싶어요.
- 세일 안 했을 때 판매량: 5개
- 세일 했을 때 판매량: 12개
```

하지만 현실에서는 **같은 시간에 같은 상품을 세일했을 때와 안 했을 때를 동시에 볼 수 없음**  

## 잠재적 결과 (Potential Outcomes)

- 잠재적 결과(Potential Outcomes)는 “어떤 처치를 했을 때 결과가 어떻게 될까?”를 표현하는 방식입니다.
- 이는 do 연산자(`do(.)`)로 표현할 수 있으며, 인과추론에서 가장 핵심적인 개념 중 하나로 꼽힙니다.
- 특히 관측하지 못하는 상황(반대 경우)을 다룰 수 있어서 counterfactual(반사실적) 결과라고도 부름

>factual outcome: 관측 할 수 있는 결과
>counterfactual outcome: 관측 할 수 없는 결과

$$Y_{ti} = Y_i \mid do(T_i = t)$$
$$Y_{ti} = Y(t)_i$$
---

- **$Y_i(t)$**: i번 대상이 처치 $t$를 받았을 때의 결과를 의미합니다.
  
  - 예를 들어:
    - $Y_{1i}$: i번 대상이 처치를 받았을 때의 결과
    - $Y_{0i}$: i번 대상이 처치를 받지 않았을 때의 결과

---

### 인과 추론에 대한 가정
- 인과 추론에는 항상 가정이 동반 된다.
- 여기서 말하는 과정은 **데이터가 어떻게 생성 되었는지에 관한 믿음에 표현**
	- 일반적으로는 데이터로 검정하기 힘든 것


## Consistency and Stable Unit Treatment Values(SUTVA)
- 잠재적 효과를 알기 위해서는 항상 두가지 숨겨진 가정이 존재한다.

###  Consistency (일관성 가정)
- **정의**: 어떤 개인이 실제로 특정 처치를 받았을 때, 그 사람의 잠재적 결과는 바로 그 처치를 받았을 때의 값과 같아야 한다는 가정입니다.
- **예시**:
    - 할인 쿠폰 실험에서 쿠폰을 받았는지 안 받았는지만 본다면, 실제로는 10%, 20%, 30% 다양한 쿠폰을 실험했을 수도 있음 → 이는 같은 "받음"이더라도 효과가 다를 수 있어서 **일관성 가정 위반**이 됨.
    - “재무 상담 받음”도 실제로는 ‘한 번만 받음’, ‘매주 관리 받음’ 등 다양할 수 있음 → **처치가 명확하게 정의되지 않음**.
        
- 쉽게 말해서, 비슷한걸 퉁 처버리면 그것은 일관성 가정을 깨는 것이 된다. 정말 명료하게 같아야한다.
---

### SUTVA (안정적 개별 처리값 가정)
- **정의**: 어떤 개인 i의 결과는 **다른 사람 j가 받은 처치에 영향을 받지 않아야 한다**는 가정
- **예시**:
    - 백신 효과 실험에서 한 사람이 백신을 맞으면, 주위 사람들도 병에 덜 걸릴 수 있음 → **네트워크 효과나 스필오버(spillover)** 발생.
    - 이 경우 통제 집단(control group)도 간접적인 효과를 받게 되어, **처치와 통제의 차이가 실제보다 작게 보이는 오류**가 생김.
- 즉, 서로 독립(independent)여야 한다는 의미

## Causal Quantities of Interest(인과 추정량)
- 한번 더 이야기하면 인과추론의 근본적인 문제는 **잠재적 결과중 하나만 관측할 수 있으므로 개별 처치효과를 알 수 없다!**
- 하지만 실망하지 마세요. 비록 개별 효과($\tau_i$)는 알 수 없지만 데이터에서 학습 할 수 있는 3가지 인과 추정량이 있으니까!

### ATE (Average Treatment Effect)
ATE는 전체 인구에서 평균적으로 처치가 주는 효과를 의미합니다. 이는 특정 처치가 전체 집단에 미치는 영향을 평가하는 데 사용됩니다.

  $$ATE = E[Y₁ᵢ − Y₀ᵢ]$$  
  또는 do-표현으로:  
  $$ATE = E[Y | do(T=1)] − E[Y | do(T=0)]$$

이론적으로는 개별 효과 $\tau_i$의 평균이지만, 실제로는 각 개인의 두 결과를 모두 알 수 없어 추정이 필요하다. 이를 관측 가능하게 만들기 위해 다양한 추정 기법이 사용됩니다.

### ATT (Average Treatment Effect on the Treated)
ATT는 이미 처치를 받은 사람들만을 대상으로 한 평균 효과를 나타냅니다. 이는 특정 집단에 대한 처치의 효과를 평가하는 데 유용합니다.

  $$ATT = E[Y₁ᵢ − Y₀ᵢ | T=1]$$

여기서도 Y₀ᵢ는 관측되지 않지만 개념적으로 정의는 가능합니다. 그러나 실제로는 관측이 불가능하여 추정이 필요합니다.

### CATE (Conditional Average Treatment Effect)
CATE는 특정 특성 X를 가진 사람들에 대해서만 평균 효과를 구하는 방법입니다. 이는 개인화된 의사결정이나 추천 시스템 등에 유용하게 사용됩니다.
  $$CATE = E[Y₁ᵢ − Y₀ᵢ | X = x]$$

특정 조건을 만족하는 집단에 대한 처치 효과를 평가하며, 이는 관측 불가능하지만 개념적으로 유용한 정보를 제공합니다.

예를 보자!
## 가정된 상황
어떤 쇼핑몰에서 **세일**(가격 할인)을 했을 때, **판매량**(Amount Sold)이 얼마나 증가했는지를 알고 싶다.

하지만 현실에서는 **세일했을 때 결과**만 보이거나, **세일하지 않았을 때 결과**만 보인다. 두 상황을 동시에 볼 수 없다. → 이것이 **인과추론의 근본 문제**임.

그래서 우리는 **평균적인 효과**를 추정한다.

---

## 🧮 3가지 주요 인과적 양

| 이름                     | 예시 해석                               |
| ---------------------- | ----------------------------------- |
| ATE (평균 처치 효과)         | 세일을 했다고 가정했을 때, 전체적으로 얼마나 판매가 늘어났을까 |
| ATT (처치를 받은 집단의 평균 효과) | 실제로 세일한 가게들에 대한 평균 효과               |
| CATE (조건부 평균 처치 효과)    | 조건 X에서의 평균 효과                       |

---

### 정말 이상적인 경우 데이터 예시 (상상의 힘으로 두 결과 다 볼 수 있다고 가정)
| i   | y0(세일X) | y1(세일O) | t(처치) | x(Xmas) | y(실제) | te(효과) |
| --- | ------- | ------- | ----- | ------- | ----- | ------ |
| 1   | 200     | 220     | 0     | 0       | 200   | 20     |
| 2   | 120     | 140     | 0     | 0       | 120   | 20     |
| 3   | 300     | 400     | 0     | 1       | 300   | 100    |
| 4   | 450     | 500     | 1     | 0       | 500   | 50     |
| 5   | 600     | 600     | 1     | 0       | 600   | 0      |
| 6   | 600     | 800     | 1     | 1       | 800   | 200    |

###  ATE (전체 평균 효과)

- 전체 평균:  
    (20 + 20 + 100 + 50 + 0 + 200) ÷ 6 = **65**
- 해석: 세일은 평균적으로 판매량을 **65개 증가**시킴
    
### ATT (실제로 세일한 가게들만)

- 세일한 가게들: 4, 5, 6번
- 평균: (50 + 0 + 200) ÷ 3 = **83.33**
- 해석: 세일을 한 가게들은 평균적으로 **83개 더 판매**

###  CATE (조건: 크리스마스 주간 x=0)

- x = 0 인 가게들: 1, 2, 4, 5
- 효과 평균: (20 + 20 + 50 + 0) ÷ 4 = **22.5**
- 해석: 크리스마스 주간에 세일한 효과는 작다 (22.5개 증가)

### CATE (조건: 크리스마스 전 주 x=1)

- x = 1 인 가게들: 3, 6
- 평균: (100 + 200) ÷ 2 = **150**
- 해석: **미리 세일한 가게들**이 훨씬 더 효과적이었다 (150개 증가)
    

---
### 하지만 현실은?

| i   | y0(세일X) | y1(세일O) | t(처치) | x(Xmas) | y(실제) | te(효과) |
| --- | ------- | ------- | ----- | ------- | ----- | ------ |
| 1   | 200     | NaN     | 0     | 0       | 200   | NaN    |
| 2   | 120     | NaN     | 0     | 0       | 120   | NaN    |
| 3   | 300     | NaN     | 0     | 1       | 300   | NaN    |
| 4   | NaN     | 500     | 1     | 0       | 500   | NaN    |
| 5   | NaN     | 600     | 1     | 0       | 600   | NaN    |
| 6   | NaN     | 800     | 1     | 1       | 800   | NaN    |

만약 여기서 이렇게 계산한다면?
```text
(세일한 가게 평균 판매량 - 안한 가게 평균 판매량)
= (500 + 600 + 800)/3 − (200 + 120 + 300)/3 = 426.67
```

→ **완전히 잘못된 결과!**

왜?  
세일한 가게들은 원래도 큰 가게일 확률이 높다.  
즉, 세일과 무관하게 **원래 많이 팔던 가게들**이어서 결과가 부풀려짐

> 이 실수는 인과추론에서 가장 큰 죄악: **상관관계를 인과관계로 착각하는 것**이다. 부름.

---

## Bias